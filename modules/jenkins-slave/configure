#!/bin/sh
set -e

SCRIPT_DIR=$(dirname $0)
SOURCES_DIR=/tmp/artifacts

mkdir -p /home/jenkins 
chown -R 1001:0 /home/jenkins 
chmod -R g+w /home/jenkins 
chmod 664 /etc/passwd 
chmod -R 775 /etc/alternatives 
chmod -R 775 /var/lib/alternatives 
# chmod -R 775 /usr/lib/jvm 
chmod 775 /usr/bin 
# chmod 775 /usr/lib/jvm-exports 
chmod 775 /usr/share/man/man1 
mkdir -p /var/lib/origin 
chmod 775 /var/lib/origin     
# unlink /usr/bin/java 
# unlink /usr/bin/jjs 
# unlink /usr/bin/keytool 
# unlink /usr/bin/orbd 
# unlink /usr/bin/pack200 
# unlink /usr/bin/policytool 
# unlink /usr/bin/rmid 
# unlink /usr/bin/rmiregistry 
# unlink /usr/bin/servertool 
# unlink /usr/bin/tnameserv 
# unlink /usr/bin/unpack200 
# unlink /usr/lib/jvm-exports/jre 
# unlink /usr/share/man/man1/java.1.gz 
# unlink /usr/share/man/man1/jjs.1.gz 
# unlink /usr/share/man/man1/keytool.1.gz 
# unlink /usr/share/man/man1/orbd.1.gz 
# unlink /usr/share/man/man1/pack200.1.gz 
# unlink /usr/share/man/man1/policytool.1.gz 
# unlink /usr/share/man/man1/rmid.1.gz 
# unlink /usr/share/man/man1/rmiregistry.1.gz 
# unlink /usr/share/man/man1/servertool.1.gz 
# unlink /usr/share/man/man1/tnameserv.1.gz 
# unlink /usr/share/man/man1/unpack200.1.gz

mv ${SOURCES_DIR}/dumb-init_1.2.2_amd64 /usr/bin/dumb-init

chmod +x /usr/bin/dumb-init

cp -rv ${SCRIPT_DIR}/contrib/bin/* /usr/local/bin/

chmod 755 /usr/local/bin/run-jnlp-client /usr/local/bin/generate_container_user /usr/local/bin/configure-slave /usr/local/bin/configure-agent